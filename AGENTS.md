# AI Agent 开发指南

## 核心原则
- **存储与计算分离**：数据只在 MinIO，计算只用 DuckDB 临时库
- **约定优于配置**：目录结构即配置，减少显式配置
- **单写者原则**：同一表分区同时只能一个任务写入

## 开发模式
1. **增量开发**：按 PLAN.md 里程碑推进
2. **测试驱动**：每个功能都要有验证脚本
3. **文档同步**：代码变更及时更新 README 和 PLAN

## 禁止事项
- ❌ 不要在 DuckDB 上建持久数据库
- ❌ 不要绕过 commit protocol 直接写数据
- ❌ 不要修改分区命名约定
- ❌ 不要添加不必要的配置项

## 工具使用规范
- 优先使用现有工具类 (`utils/*.py`)
- 新功能要抽象为可复用工具
- SQL 模板要参数化，支持 `${PARTITION_DATE}`

## 代码质量要求
- 类型注解完整
- 错误处理充分
- 日志记录详细
- 单元测试覆盖核心逻辑

## 质量保障流程

### 自动化检查
- ✅ **GitHub Actions CI/CD**：每次推送/PR 自动执行测试和代码质量检查
- ✅ **单元测试**：pytest 自动运行所有测试用例
- ✅ **代码规范检查**：ruff 自动检查代码风格和潜在问题
- ✅ **覆盖率监控**：Codecov 跟踪测试覆盖率

### 本地开发检查
# 运行测试
uv run python -m pytest tests/ -v

# 代码质量检查
uv run ruff check .

# 代码格式化
uv run ruff format .