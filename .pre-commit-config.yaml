# Pre-commit hooks for enforcing code quality and architecture boundaries
# Install: uv add pre-commit --dev && uv run pre-commit install
# Run manually: uv run pre-commit run --all-files
#
# Hooks order (fastest to slowest):
# 1. Ruff format (auto-fix)
# 2. Ruff lint (auto-fix)
# 3. Architecture check
# 4. Tests (only on source changes, fail-fast)

repos:
  - repo: local
    hooks:
      # Fast: code formatting (auto-fix)
      - id: ruff-format
        name: Ruff Format
        description: Format Python code with ruff
        entry: uv run ruff format
        language: system
        files: \.py$
        types_or: [python]

      # Fast: linting (auto-fix)
      - id: ruff-check
        name: Ruff Lint
        description: Check and fix Python code issues
        entry: uv run ruff check --fix
        language: system
        files: \.py$
        types_or: [python]

      # Medium: architecture boundary enforcement
      - id: check-lakehouse-core-imports
        name: Check lakehouse_core Architecture
        description: Ensure lakehouse_core/ remains orchestrator-agnostic
        entry: uv run python scripts/check_imports.py
        language: system
        files: ^lakehouse_core/.*\.py$
        pass_filenames: true

      # Slow: run tests (fail-fast, only when code changes)
      - id: pytest
        name: Tests (pytest)
        description: Run pytest - fail fast on first error
        entry: uv run pytest -x -q --tb=short
        language: system
        files: ^(lakehouse_core|dags|tests)/.*\.py$
        pass_filenames: false
